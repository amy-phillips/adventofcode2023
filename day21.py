input = """...................................................................................................................................
.....#.......##....#...#..##......#.#....#......#...#..####....................#.........#............#..........#.#...............
...#.......#......#...........#........#.#..........#..........................#..#....#.....#.#.......#.#.......#.....#....#......
............#...#..##.#...#..#.#.....................#..................#.......#.#......#..#....#........#.#....#...#.##.....#....
..#......#...#............#.....#..##..................#..................#....#.......#.........#...#..................#..##......
.#.#......#.....#.................#..........#.#.#.#...#............................#.#.....#....................#.....#.........#.
.......#...............#.#.........#....#......................................#.##.##...........#............#...............#....
..#..#....#...#......#....#....#.#....#.##............#...........#............#.....#..#....#....#..#.#..#.........##...#.......#.
..#....#......................#.#..................#.#.......#................................#.......##.......................#...
.....#....#...#.....#.....#..........#..#...#.....#.........#...................#.....#..##..................#...........#....#....
........#.....##..#..#.#...#.#...#............#.#.#.........#.....##.#.......................#......................#.........#..#.
..#......#..........#.......#...#..##.#.......#..#............#....#................#.....#.#.....###.......##.......#.##...#...#..
..#.......#.#......#......##......#..#.#..#..............#..#..#......#...........###..........##.#.......#..#.....#.....#..#......
......#..##.......#..#......#....#.#............#............#..#......###........##..#..#.....#.....#......##.##...........#......
.........#........#.#............#.....##.##.#................#....#...#.###.......#..#.....#...###.#.....#.....#.#...........#....
.#...##..##..............#...........#................#.#............##....#............#................#.#........#..............
..#...............#............##.....##.#............#..##............#.#.............##.......#.......#.#......##..#..#.#........
.#.#....#..#.....#....##..#.......#.......................##.#.##..#..#.................#.....##.#...#.............#.........#.....
....##...............#.#....##..##.......###.........#..................##...............#..#.....#.#...#...#...#...#..............
..#.#..#....#.............#...#..#..................#..#...#......#.#.##..#..#..........#.#....##.#.#....##..#...#......#........#.
............#.#...###................#..............#.............#...#......................#..........#.#...#......#.###..#......
.#..#....#..........#....................................#...#....#....#..#......#............#...#...#...........##...............
.#.##..#...#...................................#.#....#......#..#.................................#.#.#....#.#.#.#..............#..
................#.................#..#........................................................#....#...##...................#......
...#.##...........#..#..#.......#..............#.....#...#..#..#.....#..#...........................##.....#..#.#...............#..
.........#.....#..#..........#...#..............................#.......#..#.....#....#........#......##....#....#..............#..
......................#........#...............##..........#...#..#..#...#........#....#.................#...##.#.....##...........
.....##..........###..........#.................................#...............#..................##...............#.........#....
..#....#..#....#...........#....#........#......#.#..#....#........#........#...#....................#....#..#....#.....#.....#....
.....#.........#..#......#................#......#..........#........................#.................#.#...........#.....##.#.#..
....#...#.............#.#...#............#...###.....................#....#.....#..........#.............#..#.##..#............#...
............##......#..................#.........#.#........#.#...##..##.....###..#........#............#...#...........#.....#....
......#..#............#.#..#...................#....#..#....#.....#....#.......##...##..###.............#...#........#.........#...
.......#........#...#.................#....#.......#......#.###....#....#...#.........##.....#........#.#....................#.....
.##.##...#.#.......#.#.#.................#.####..#...#.##..............#....#............#...#................#......##.....#......
....#.....#...#.......#.#.....................................#.......#.#............#...#...................#....#................
...#...#...#...#.#................#...#..............#.....#.###......#.....#.....#...#......#...............#....#.........#......
...................#..#.............#...........#...#........#......#.#............##........#..................#...#....#....#....
.....#.......#.....##............#.....#........#...#...##..#..#.............#.........#...............................#..#........
......................#.................#.#......#...#.............#.#........#...#....#.#......#.................#...###..##......
.#..............#............#..##....#........#.#.........#....#.#..#..##.#.........................#.......#.##....##.......#....
...#....#..#..#....................#.......#........#.#...................#.....#............#..................#.............#.##.
.........##.....................#.....#.......#...#................#....#.....#...#...#.##.....#......#........#.........#.........
..........................##.................#.#.#...#.......##....#...#..#....#...........#............................#..........
.#...#.....................#......................#......#...........#.##...#.#....#..##..#............#...........................
......##........#.........##...#...###....................#.........#.....#..#................#.........#.............#.......#....
.###.#.#.....#.#.........#...#..##...#.........#..#..#............................#.............#..#.#....#..........#......#......
......#.#.....#.......#............#.....#..........#.............#......#.#..##..#...#......#......#....................#.....#...
.......#.............#...#..#..#.........###.....#....#...#.#.#...##......#.........#......##..#........#....#.........#....#......
...........##............#...#................#......#.....#............#........#.................#.....................##........
......#................##.........#.......#..............##.#.....#.......##...#.............#........#.##.................#.#.....
.......#..........##.............#.....#....##...........##...................#......................#........#................#...
...#........................................#......#......#....#..#......#...........#.....#..##....##......#..#.............#...#.
......#............#..............##...........##......#..........#..........#....#...#....#........#.....#.#................#.....
...#..#...........#.#....###................#.........#...#...#.#.#..#..........#....#.............................#.......#.......
.................##....####............#........#....#............#........#...#..#...........#.......#...#.#...............#......
..........................#......#......#..#..#....#........#...............#.............#........#..#...#..#.#...#.#.............
...##........#..........#.#...................#...#.....#...#.#.#..#............##....#..#...#.#.#..............#..............#...
...........#...........#.##....#...#.#....#......#............#.#..#............#..##......#.#......#............#.#...............
.#........#.............#.#..#.#.......#............#.....#.......................#..........#......#......#....#..................
...........##.#.....##............#..................#.##....#..#........#....#..#...................##...........##..#..........#.
.........#....#....#............#....#...............##..........................#...........#................#.#...#..#...........
........#......#.............#...............#..#.#.#..#...#..###....#............#.......#......#......#......##....###.##........
........#...##..#....##.#.##.#.........#................#..#........#..........#.........#..............#...##.......#.##..........
.........#......#...#.............#..#.#..#.#............#.....#........#............#...#.#.................#......#..#...........
.................................................................S.................................................................
.......##..##........##.#...........#...#...........#...#.#.#..........##.......#.....#.#...#.......................#..............
..................#.............#..#...#..#...#.....#...........#........#........#..#.#...#...#......................##..#.#......
...........#....#.......#..##.#......#..........#...........#.....#.####.##...#..#...............##...#............####............
................#.....#..#....#.........#.......###....#..............#.......#..#..##.........##..#......#.......#................
.........#....#............#.#..#.......#.#..................#...............#.....#.............#..........#......#...............
....................###..........................#...........#.#...#....###.#...............#..#....#..................#.........#.
...........#.......#..........#....#..#.#...............##..........#....#.....#...#...........#........##......#..................
.#..#..................#.##......#......#.#.#.#....#..........#...#...#.................#.......#.#.....#...#......................
...#.................#..#...........#.#......#.............#...................#.#............#......#..#...........#.........##...
...#............#.....#......#.............#......#.......#.#.......#....#.........##...#......#.....##..........#.................
....#.#........#..#........#.#...................#........##...#.......#...#.....#.#...#.#.#.......................................
.....##.................####.##.....#....##.#.#..#..#.....#....#.......#........#..#....#...#..............#.......................
.....................#...#....#...........#..#.........#.......#.......#......#..#....#.#..........#....#....#............#...#....
.........................##..........#......##.#........#.....#....#......##...................#...........#...............#.#.....
..##....................................#..#........#.....#.......#..#...................#........#...........#....................
.................................##............#.......#...........#.......##.##.....##.......#...##.......##.............#........
.#.#..#....#.........#..........#...#....#.#.##............#..#...#...#...#....#...#.#....#..#.........#.....#.........##....#.....
...#...#..#...........#.....##............#.....#........#.#...........##....##.#..#.#..........##.................................
....#...#.#...............................##.#.......#.#......##...#....##.........#.#..........#......##..#.......#...........##..
............#..................#.......#..............#...#.....#..#.........#....#.##.#......#....#...#..#........#.#.....#..#.##.
..##..........##.#..........#..#....#.#.##...............#..#......#...#.#..#.......#......#.#.......##..............#...#.........
................................#.#.#.....#..#.#...#.....#..##..........#...##..#.#.#........#..................#.###......#.......
..#..........................#...........#.#....##.......#..........##....##.........#.............#.##........#...#......#........
.#......#.....................#.........#.#.....#.#.#..#...............#..#......#..............#..#.#.............................
.#.......#.....##....#..........#...#....##.#.##..#..#........#......##..............##..........#.............#..#..#...........#.
...#.....#...#..#.....#..........#...#.....#.........................#.##.#.....................#...........................#......
...........#.........#.#..................#..#..#.............#.........#....#..#..#..#..#........##........#...##....#..........#.
.........#.#.....#..............###.....#....#.##..###......##.#..#.........#.....#.....................................#...#..#...
....#....#.#.#....#...............#.....##...#......#.......#........#.............#.#........#............#...##..#..#............
...##.#.#......#.#...........................#............#...............#.......#.......#...................##...###..#...##.#...
........#.............##...............#..........#......#.....#...##.......#...............#.#.........#.......##.................
.##.#.........#.......#.....#............#.....#...#.................#..#.##....#...#......##.#............##......#...#####..#....
...#.....#...#.......#.##.#.#.........#..#...................##...............#.........................#..#...#.........###.......
..........................#..................#.#...........#....#..........#...........................#................#....#..#..
................#....#......#............#..###..##.......................#......#..#.....#........#.#........#...#...#..#.......#.
..............#.....##....#.#..#........#....#......#....................#.........#...............#............#..............#...
.......#..##.........#.........#................#........................#......#..................#..##.#....##..........#........
..#.....#...............#....................#.#..#..##....#...........#.....#.....#................#......##..#......#..#.......#.
...#....##............#...#.................#.#.................................#.#....#............##.....#.................#..#..
..........#..........#....##.................##...............#..........#......#.....#............#..#.##.....#....##.............
....................##................................#..#.....#....#.....#.....#..............#..#.............#..................
.......................#...........#.................#.#...................#...##..............##....#......#...............#....#.
..........##.....#...#...##..#.#....#..#..........#..........#....#..#.....#..#............#......#.#......#...#..#.#.#......#.....
.....#............##...#....#.#..#.#....#.............###.........#..#......#.............#......#....#.........#........#.#.###...
....#....##.##..#.#......#.##............#.........#...#...#.........#.....#.#..................#.................#.......#........
......#.....#.......#.......#.......#..#...............#....##..#.....#.......................#......#............##.....#.....#...
.#.........#...#....................#.#.....................#......#......#............#.#.........#............#........#...#..##.
..#.#.#...........#....##..#...#..............................#...............#........#....#.##.......#..........#....#...........
.................#...##...............#...#..#.........................#.#...............#.##....................#.#....#..........
............##.#.......#...................##..........##.......#.#.......................#.............#..#....###.....#..........
...............#..#....#..............#....###..................#.##.................#.#...#...##.#.#..#................#......##..
....#......#.#.#.....#..##.#.##.......###......#.............##...................#...#.......#....#..#.........#..................
..#..........#.....#...#.................................#...........#...#..................#..........##....#..#..#...#.##........
............###................#.#..#......##.................##.....##............#..................#.....##..#..................
.........#..#...........#..............#.......#................#...###.......................#.##....#......#.##.##...............
...##...###..........#..##.................#......##.........#....................#..#......#....#........#..#......##.............
........##.........#.........#..#.....#.#..........#.................#..............#....#....#....#..#...#.#..#...........#.......
..#..#.#.....#........##...##.........#...........................#.........#.....#.........#......#.......#..#...####.........#...
......#......#...............#....#..#..#....#....#...............................#....#.........#...#..#.#...#..##...#........#...
..#.##...##.....#.#......#...#..#...........#..........#......................#.#.....#.......#..........##..##.......#............
.......#......#..................#....#.#................#...............#...........##...........................#.#........#.....
............##....................#..........#.........#................#....#..#..#.....#......#....#.........##..#.........#.....
.............###..#.##..#...........................#...#.....................#...........#.....###.......#....#..........##.....#.
.#..#...#.#.#....#.###...##........#.....#........#.....#.....................#.#..#.#......##...........#..#......#........#......
..................................................................................................................................."""


type Location = tuple[int,int]
type Garden = dict[Location,str]

import cProfile

def parse_map(input: str):
    garden_map: dict[Location,character] = {}
    start_position: Location
    for line_idx,line in enumerate(input.split('\n')):
        for row_idx,character in enumerate(line):
            garden_map[(row_idx,line_idx)]=character
            if character == 'S':
                start_position = (row_idx,line_idx)
    return garden_map, start_position, (row_idx+1,line_idx+1)

def try_position(position:Location, garden_map: Garden):
    if not position in garden_map:
        return False # fell off edge
    if garden_map[position] == '.':
        return True
    if garden_map[position] == 'S':
        return True
    return False

def take_step(position: Location, garden_map: Garden):
    positions = []
    if try_position((position[0]-1,position[1]), garden_map):
        positions.append((position[0]-1,position[1]))
    if try_position((position[0]+1,position[1]),garden_map):
        positions.append((position[0]+1,position[1]))
    if try_position((position[0],position[1]-1),garden_map):
        positions.append((position[0],position[1]-1))
    if try_position((position[0],position[1]+1),garden_map):
        positions.append((position[0],position[1]+1))
    return positions

def debug_print(positions: list[Location], garden_map: Garden, extents: tuple[int,int]):
    for y in range(0,extents[1]):
        for x in range(0,extents[0]):
            if (x,y) in positions:
                print("O",end="")
            else:
                print(f"{garden_map[(x,y)]}",end="")
        print("") # newline
    print("") # newline

def run():
    garden_map, starting_position, extents = parse_map(input)

    steps_cache: dict[int,int] = {} # maps a hash of the current positions to the step number this was encountered
    all_positions_seen: list[list[Location]] = []

    positions = [starting_position]
    for i in range(0,64):
        # stash the list of positions - we might use it again if we detect a loop
        all_positions_seen.append(positions)
        #debug_print(positions, garden_map, extents)
        cache_key = hash(str(positions))
        if cache_key in steps_cache:
            same_as_step = steps_cache[cache_key]
            # so next up is same_as_step+1
            next_positions = all_positions_seen[same_as_step+1]
        else:     
            next_positions = []
            for position in positions:
                stepped_positions = take_step(position, garden_map)
                next_positions.extend(stepped_positions)
        next_positions=list(set(next_positions)) # remove duplicates!
        positions,next_positions = next_positions,positions # swap lists
        if not cache_key in steps_cache:
            steps_cache[cache_key] = i # stash this in case we see this set of positions again
    debug_print(positions, garden_map, extents)
    print(len(positions))

cProfile.run("run()")