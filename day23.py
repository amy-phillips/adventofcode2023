actual_input="""#.###########################################################################################################################################
#.....#...#####.......#.........#.......#...........#.....#.......#.....#...#...#...................#...#...#...#...#...#...#.......#.......#
#####.#.#.#####.#####.#.#######.#.#####.#.#########.#.###.#.#####.#.###.#.#.#.#.#.#################.#.#.#.#.#.#.#.#.#.#.#.#.#.#####.#.#####.#
#.....#.#.###...#.....#.#.......#.#.....#.........#...#...#.#.....#...#.#.#.#.#.#.................#.#.#...#.#.#...#.#.#.#.#.#.#.....#.#.....#
#.#####.#.###.###.#####.#.#######.#.#############.#####.###.#.#######.#.#.#.#.#.#################.#.#.#####.#.#####.#.#.#.#.#.#.#####.#.#####
#.#...#.#.#...#...#.....#.......#.#.#.....###...#.....#.....#...#...#.#.#.#.#.#.###...###...#.....#.#...#...#.#.....#.#.#.#.#.#.#.....#.....#
#.#.#.#.#.#.###v###.###########.#.#.#.###.###.#.#####.#########.#.#.#.#.#.#.#.#.###.#.###.#.#.#####.###.#.###.#.#####.#.#.#.#.#.#.#########.#
#.#.#.#.#...###.>...#...#.......#.#.#...#.#...#.#...#.#.........#.#.#.#.#.#.#.#...#.#...#.#...#...#.>.>.#...#.#...#...#.#.#.#.#...#...#...#.#
#.#.#.#.#######v#####.#.#.#######.#.###.#.#.###.#.#.#.#.#########.#.#.#.#.#.#.###.#.###.#.#####.#.###v#####.#.###.#.###.#.#.#.#####.#.#.#.#.#
#.#.#.#...#.....#.....#...#.....#.#.#...#.#...#...#...#...#.....#.#.#.#.#.#.#.#...#...#.#.......#...#.....#.#...#.#.#...#.#...###...#...#.#.#
#.#.#.###.#.#####.#########.###.#.#.#.###.###.###########.#.###.#.#.#.#.#.#.#.#.#####.#.###########.#####.#.###.#.#.#.###.#######.#######.#.#
#.#.#...#.#.....#...#...###.#...#.#.#...#...#.......#.....#.#...#.#...#.#.#...#.#.....#.###...#.....#...#.#.#...#.#.#.....#...#...###...#...#
#.#.###.#.#####.###.#.#.###.#.###.#.###.###.#######.#.#####.#.###.#####.#.#####.#.#####.###.#.#.#####.#.#.#.#.###.#.#######.#.#.#####.#.#####
#.#...#...#.....#...#.#...#.#.....#.###...#.###.....#.#.....#.###.....#.#.#.....#.#.....#...#...#.....#...#...###...#.......#...#.....#.....#
#.###.#####.#####.###.###.#.#######.#####.#.###.#####.#.#####.#######.#.#.#.#####.#.#####.#######.###################.###########.#########.#
#.#...#...#.....#.#...#...#...#.....#.....#...#.....#.#.#.....#.......#.#.#.#...#.#.#...#.......#.......#.......#.....#...#...#...#...#...#.#
#.#.###.#.#####.#.#.###.#####.#.#####.#######.#####.#.#.#.#####.#######.#.#.#.#.#.#.#.#.#######.#######.#.#####.#.#####.#.#.#.#.###.#.#.#.#.#
#.#.#...#.......#...#...#...#.#.>.>.#.....#...#...#.#.#.#.#...#.......#.#.#.#.#.#.#.#.#.###...#.#.......#.#...#.#.......#...#...#...#...#...#
#.#.#.###############.###.#.#.###v#.#####.#.###.#.#.#.#.#.#.#.#######.#.#.#.#.#.#.#.#.#.###.#.#.#.#######.#.#.#.#################.###########
#.#.#.#...#...#...###.....#.#.#...#...#...#.#...#.#.#.#.#.#.#...>.>.#.#.#.#.#.#.#.#.#.#.>.>.#.#.#.#...###.#.#...#...#...#...#...#...###...###
#.#.#.#.#.#.#.#.#.#########.#.#.#####.#.###.#.###.#.#.#.#.#.#####v#.#.#.#.#.#.#.#.#.#.###v###.#.#.#.#.###.#.#####.#.#.#.#.#.#.#.###.###.#.###
#.#.#.#.#.#.#...#.....#.....#.#.#...#...###...#...#.#.#.#.#.#.....#.#.#.#.#.#.#...#...#...#...#.#.#.#.....#...###.#...#...#...#...#.....#...#
#.#.#.#.#.#.#########.#.#####.#.#.#.###########.###.#.#.#.#.#.#####.#.#.#.#.#.#########.###.###.#.#.#########.###.###############.#########.#
#.#.#...#...#.........#...#...#...#.......#.....#...#...#...#.....#...#.#.#.#.#.....#...###.....#.#.#...#...#...#...#...........#...........#
#.#.#########.###########.#.#############.#.#####.###############.#####.#.#.#.#.###.#.###########.#.#.#.#.#.###.###.#.#########.#############
#.#.#...#.....#...#...###.#.#.........#...#.#...#.#.......###...#.....#...#...#...#.#.......#.....#.#.#...#.....#...#.###.......#...........#
#.#.#.#.#.#####.#.#.#.###.#.#.#######.#.###.#.#.#.#.#####.###.#.#####.###########.#.#######.#.#####.#.###########.###.###.#######.#########.#
#...#.#.#.....#.#...#...#...#...#...#...###...#...#.#.....#...#.#.....#...#...###.#.#.....#.#.#.....#...........#...#...#.#...#...#.........#
#####.#.#####v#.#######.#######.#.#.###############.#.#####.###.#.#####.#.#.#.###.#.#.###.#.#.#.###############.###.###.#.#.#.#.###.#########
#.....#.#...#.>.#.......#...###...#.#.....#.....###.#.#...#...#.#.###...#...#.....#...###...#...#...............###.....#...#.#.#...#...#...#
#.#####.#.#.#v###.#######.#.#######.#.###.#.###.###.#.#.#.###.#.#v###.###########################.###########################.#.#.###.#.#.#.#
#.....#...#...#...#.....#.#.#...#...#.#...#...#...#.#.#.#.#...#.>.>.#...................#.........#...............#.........#...#.....#...#.#
#####.#########.###.###.#.#.#.#.#.###.#.#####.###.#.#.#.#.#.#####v#.###################.#.#########.#############.#.#######.###############.#
#.....#.......#...#...#.#.#.#.#.#.....#...###...#.#.#.#.#.#...###.#.#...#...#...........#...........#.............#.....#...#...#.....#...#.#
#.#####.#####.###.###.#.#.#.#.#.#########.#####.#.#.#.#.#.###.###.#.#.#.#.#.#.#######################.#################.#.###.#.#.###.#.#.#.#
#.......#.....###...#.#.#.#.#.#...........#...#.#...#...#.#...#...#.#.#.#.#.#.......#...#...#.........#...........#...#.#.....#...###...#...#
#########.#########.#.#.#.#.#.#############.#.#.#########.#.###.###.#.#.#.#.#######.#.#.#.#.#.#########.#########.#.#.#.#####################
#.......#.....#...#.#.#...#.#.......#.....#.#.#.....#.....#.#...#...#.#.#.#.###.....#.#.#.#.#.........#...#.......#.#.#.................#...#
#.#####.#####.#.#.#.#.#####.#######.#.###.#.#.#####.#.#####.#.###.###.#.#.#.###v#####.#.#.#.#########v###.#.#######.#.#################.#.#.#
#.....#.......#.#...#.....#.#...###.#...#.#.#.#...#.#...#...#...#...#.#.#.#.#.>.>.....#.#.#.#...#...>.>.#.#.###...#.#.#...###...........#.#.#
#####.#########.#########.#.#.#.###v###.#.#.#.#.#.#.###.#.#####.###.#.#.#.#.#.#v#######.#.#.#.#.#.###v#.#.#.###.#.#.#.#.#.###v###########.#.#
#####.........#.......#...#...#...>.>.#.#.#.#.#.#...###.#.#.....###.#.#...#...#...#.....#.#.#.#.#.#...#...#.....#.#.#...#...>.###...#...#.#.#
#############.#######.#.###########v#.#.#.#.#.#.#######.#.#.#######.#.###########.#.#####.#.#.#.#.#.#############.#.#########v###.#.#.#.#.#.#
#.....#.......###.....#.......###...#...#...#.#...###...#.#.......#.#...#.........#...#...#.#.#.#.#.......#.......#.#.........#...#.#.#.#.#.#
#.###.#.#########.###########.###.###########.###.###.###.#######.#.###.#.###########.#.###.#.#.#.#######.#.#######.#.#########.###.#.#.#.#.#
#...#.#.........#.....#...#...#...#...#...###.....#...#...###.....#.....#...........#.#.###...#.#.#.......#...#...#.#...#.....#...#.#.#.#.#.#
###.#.#########.#####.#.#.#.###.###.#.#.#.#########.###.#####.#####################.#.#.#######.#.#.#########.#.#.#.###.#.###.###.#.#.#.#.#.#
#...#...........#.....#.#...###.....#...#.....#...#.....#...#.......#.....###...#...#...#...###...#.........#.#.#.#.###.#.#...#...#...#...#.#
#.###############.#####.#####################.#.#.#######.#.#######.#.###.###.#.#.#######.#.###############.#.#.#.#.###.#.#.###.###########.#
#...#.........#...#.....#.....###...........#...#...#.....#.........#...#.#...#.#...#.....#...###...#.......#...#...###.#.#.....#...#...#...#
###.#.#######.#.###.#####.###.###.#########.#######.#.#################.#.#.###.###.#.#######.###.#.#.#################.#.#######.#.#.#.#.###
#...#.#.......#.....#.....#...#...#...#...#.........#...........#.....#.#.#...#.....#.#.......#...#.#...###...###.....#...###...#.#...#...###
#.###.#.#############.#####.###.###.#.#.#.#####################.#.###.#.#.###v#######.#.#######.###.###.###.#.###.###.#######.#.#.###########
#.....#...........#...#...#.###.....#.#.#...#.....#...###...#...#...#.#.#.#.>.>.....#.#.#...#...#...###.....#...#.#...#.......#...###.......#
#################.#.###.#.#.#########.#.###.#.###.#.#.###.#.#.#####.#.#.#.#.#v#####.#.#.#.#.#.###.#############.#.#.###.#############.#####.#
#...#...#.........#.....#.#.#...#.....#.#...#...#...#.#...#.#.....#.#...#.#.#.#.....#.#.#.#.#.#...#...#.........#.#.###.....#.....#...#...#.#
#.#.#.#.#.###############.#.#.#.#v#####.#.#####.#####.#.###.#####.#.#####.#.#.#.#####.#.#.#.#.#.###.#.#v#########.#.#######.#.###.#.###.#.#.#
#.#.#.#.#.....#...#...#...#.#.#.>.>.....#.#...#.#.....#...#.......#.....#...#.#.#...#.#.#.#.#.#.#...#.>.>...#...#.#...#...#...###.#.#...#...#
#.#.#.#.#####.#.#.#.#.#.###.#.###v#######.#.#.#.#.#######.#############.#####.#.#.#.#.#.#.#.#.#.#.#####v###.#.#.#.###.#.#.#######.#.#.#######
#.#...#...#...#.#...#.#...#...###.....#...#.#.#.#.......#.........###...#.....#...#.#.#.#.#.#.#.#.#...#...#.#.#...#...#.#.###...#...#...#...#
#.#######.#.###.#####.###.###########.#.###.#.#.#######.#########.###.###.#########.#.#.#.#.#.#.#.#.#.###.#.#.#####.###.#.###.#.#######.#.#.#
#.......#.#...#.....#.#...#...........#.#...#...#.......#.........#...###.........#.#.#.#.#...#.#.#.#.....#...#.....#...#.#...#.#...###...#.#
#######.#.###.#####.#.#.###.###########.#.#######.#######.#########.#############.#.#.#.#.#####.#.#.###########.#####.###.#.###.#.#.#######.#
#.......#.....#...#.#...###...........#.#.#.......###...#.....#...#.......#.......#...#...#.....#.#.....###.....#...#...#.#.#...#.#.###.....#
#.#############.#.#.#################.#.#.#.#########.#.#####v#.#.#######.#.###############.#####.#####.###.#####.#.###.#.#.#.###.#.###v#####
#...#.......#...#.#.....#...#.........#.#.#...#.....#.#...#.>.>.#.#.......#...............#.....#.#...#...#...#...#.#...#.#.#.#...#.#.>.#...#
###.#.#####v#.###.#####.#.#.#.#########.#.###.#.###.#.###.#.#v###.#.#####################.#####.#.#.#.###.###.#.###.#.###.#.#.#.###.#.#v#.#.#
###...#...#.>.###.......#.#.#.....#...#...#...#.#...#.#...#.#...#.#.....#.................#.....#.#.#.....###.#.#...#.#...#.#.#.###...#.#.#.#
#######.#.#v#############.#.#####.#.#.#####.###.#.###.#.###.###.#.#####.#.#################.#####.#.#########.#.#.###.#.###.#.#.#######.#.#.#
###...#.#...###...#...###.#.#####...#.....#...#.#.....#...#.#...#.......#.................#.....#.#.........#...#...#.#.....#...###...#...#.#
###.#.#.#######.#.#.#.###.#.#############.###.#.#########.#.#.###########################.#####.#.#########.#######.#.#############.#.#####.#
#...#...#.....#.#.#.#...#.#.............#.#...#...#.......#.#.....###...#...#.............#...#...#...#.....#.....#...#.........#...#.......#
#.#######.###.#.#.#.###.#.#############.#.#.#####.#.#######.#####.###.#.#.#.#.#############.#.#####.#.#.#####.###.#####.#######.#.###########
#.#.....#.###.#.#...#...#.............#...#.......#.........#.....#...#.#.#.#.....#...#...#.#.#...#.#...#...#...#...###.......#.#...........#
#.#.###.#.###.#.#####.###############.#######################.#####.###.#.#.#####.#.#.#.#.#.#.#.#.#.#####.#.###.###.#########.#.###########.#
#.#.#...#.#...#.#.....#...###.......#.#...#...#...###...#.....#...#...#...#.###...#.#...#.#.#.#.#.#.......#.#...#...#.....#...#.#...#...#...#
#.#.#.###.#.###.#.#####.#.###.#####.#.#.#.#.#.#.#.###.#.#.#####.#.###.#####.###v###.#####.#.#.#.#.#########.#.###.###.###.#.###.#.#.#.#.#.###
#...#.....#.....#.......#...#.#...#.#.#.#.#.#.#.#.#...#.#...#...#.###.....#.#.>.>.#.#.....#.#.#.#.#.........#...#.###...#.#...#.#.#.#.#.#...#
###########################.#.#.#.#.#.#.#.#.#.#.#.#.###.###.#.###.#######.#.#.#v#.#.#.#####.#.#.#.#.###########.#.#####.#.###.#.#.#.#v#.###.#
#.........#.............#...#...#.#...#.#.#.#.#.#.#...#.###...#...#.......#...#.#...#...#...#.#.#.#.....#...#...#...#...#.#...#...#.>.#...#.#
#.#######.#.###########.#.#######.#####.#.#.#.#.#.###.#.#######.###.###########.#######.#.###.#.#.#####v#.#.#.#####.#.###.#.#########v###.#.#
#.....#...#...........#...#.....#...###.#.#.#.#.#.....#.#...#...###...........#.....#...#...#.#.#...#.>.>.#...#...#.#.#...#...###...#...#.#.#
#####.#.#############.#####.###.###.###.#.#.#.#.#######.#.#.#.###############.#####.#.#####.#.#.###.#.#v#######.#.#.#.#.#####.###.#.###.#.#.#
#.....#.#...#.........#...#...#.#...#...#.#.#.#.....#...#.#.#.....#...#.......#.....#.#...#.#...#...#.#.#...###.#.#.#.#...#...#...#.....#...#
#.#####.#.#.#.#########.#.###.#.#.###.###.#.#.#####.#.###.#.#####v#.#.#.#######.#####.#.#.#.#####.###.#.#.#.###.#.#.#.###.#.###.#############
#.....#.#.#.#.......###.#...#.#.#...#...#.#.#.#...#.#...#.#.#...>.>.#.#...#...#.....#.#.#...#.....#...#...#...#.#.#...###...###.............#
#####.#.#.#.#######v###.###.#.#.###.###.#.#.#.#.#.#.###.#.#.#.###v###.###.#.#.#####.#.#.#####.#####.#########.#.#.#########################.#
#.....#...#.......#.>.#.#...#.#.#...#...#.#.#...#.#.#...#.#...#...###...#.#.#.......#...#.....#...#.#.......#...#.....#.....................#
#.###############.#v#.#.#.###.#.#v###.###.#.#####.#.#.###.#####.#######.#.#.#############.#####.#.#.#.#####.#########.#.#####################
#.#.....#...#...#...#...#.#...#.>.>.#.#...#.....#...#.#...#...#.......#...#...........###.#...#.#.#.#.....#...........#.....................#
#.#.###.#.#.#.#.#########.#.#####v#.#.#.#######.#####.#.###.#.#######.###############.###.#.#.#.#.#.#####.#################################.#
#...#...#.#.#.#.........#.#...#...#...#...#...#.#.....#.#...#.........###...........#...#.#.#.#.#.#.#...#...............###...#.............#
#####.###.#.#.#########.#.###.#.#########.#.#.#.#.#####.#.###############.#########.###.#.#.#.#.#.#.#.#.###############.###.#.#.#############
#...#.....#.#.#.........#.#...#...#.....#.#.#...#.#.....#...............#.........#.....#...#.#.#...#.#.................#...#.#.............#
#.#.#######.#.#.#########.#.#####.#.###.#.#.#####.#.###################.#########.###########.#.#####.###################.###.#############.#
#.#.......#...#.........#.#.#.....#.#...#.#.....#...#.........#.....#...#.........#.........#...#...#...........#...#...#...#.#.....#...#...#
#.#######.#############.#.#.#.#####.#.###.#####.#####.#######.#.###.#.###.#########.#######.#####.#.###########.#.#.#.#.###.#.#.###.#.#.#.###
#.......#.#...#.........#.#.#...#...#...#.......#...#.......#.#...#.#...#.........#.#...#...###...#.#...#...###...#...#...#.#...###...#.#...#
#######.#.#.#.#.#########.#.###.#.#####.#########.#.#######.#.###.#.###.#########.#.#.#.#.#####.###.#.#.#.#.#############.#.###########.###.#
#.......#...#...#.......#.#.###...#...#...#.....#.#...#.....#.....#...#.#.....#...#.#.#...#...#...#...#...#.......#.......#.....#...###.....#
#.###############.#####.#.#.#######.#.###.#.###.#.###.#.#############.#.#.###.#.###.#.#####.#.###.###############.#.###########v#.#.#########
#.................#.....#.#.#.......#.....#.#...#.#...#.........#...#...#...#.#.....#...#...#.###...............#...#.....###.>.#.#.........#
###################.#####.#.#.#############.#.###.#.###########.#.#.#######.#.#########.#.###.#################.#####.###.###.#v#.#########.#
#...................#...#...#...........###.#.###.#.#...###.....#.#.....#...#.#...#.....#...#.#...#...#.....###...###.#...#...#...#.........#
#.###################.#.###############.###.#.###.#.#.#.###v#####.#####.#.###.#.#.#.#######.#.#.#.#.#.#.###.#####.###.#.###.#######.#########
#...#...............#.#.###...#...#.....#...#...#.#.#.#.#.>.>.....#.....#...#...#.#.#...###.#.#.#.#.#.#...#.###...#...#.#...#.......###...###
###.#.#############.#.#.###.#.#.#.#.#####.#####.#.#.#.#.#.#v#######.#######.#####.#.#.#.###.#.#.#.#.#.###.#.###.###.###.#.###.#########.#.###
#...#.#...........#.#.#.....#.#.#.#.....#.....#.#.#...#...#.###.....###...#.....#...#.#...#.#.#.#.#.#.#...#.#...###...#.#...#...#.....#.#.###
#.###.#.#########.#.#.#######.#.#.#####.#####.#.#.#########.###.#######.#.#####.#####.###.#.#.#.#.#.#.#.###.#.#######.#.###.###.#.###.#.#.###
#...#.#.........#...#.#.......#.#.#...#.#...#.#.#.###...###...#...#...#.#.#...#...###...#.#.#.#.#.#.#.#.#...#...###...#.....###.#...#...#...#
###.#.#########.#####.#.#######.#.#.#.#v#.#.#.#.#.###.#.#####.###.#.#.#.#.#.#.###.#####.#.#.#.#.#.#.#.#.#.#####v###.###########.###.#######.#
###...#####...#.#...#.#.#...#...#.#.#.>.>.#...#...#...#.......###.#.#.#.#.#.#.#...#...#.#.#.#.#.#.#.#.#.#.#...>.>.#.........#...#...###.....#
###########.#.#.#.#v#.#.#.#.#.###.#.###v###########.#############.#.#.#.#.#.#.#v###.#.#.#.#.#.#.#.#.#.#.#.#.###v#.#########.#.###.#####.#####
#...........#.#...#.>.#...#.#.###...###.#...#.....#...........###.#.#...#.#.#.>.>...#.#.#.#.#.#.#.#.#.#.#...#...#...#.....#.#...#.#.....#...#
#.###########.#####v#######.#.#########.#.#.#.###.###########.###.#.#####.#.###v#####.#.#.#.#.#.#.#.#.#.#####.#####.#.###.#.###.#.#.#####.#.#
#...........#...###.....#...#...#.......#.#...#...#...#.......#...#.....#...###...###.#.#.#.#.#.#.#.#...#.....#...#.#...#.#...#...#.......#.#
###########.###.#######.#.#####.#.#######.#####.###.#.#.#######.#######.#########.###.#.#.#.#.#.#.#.#####.#####.#.#.###.#.###.#############.#
###...#...#...#.#...#...#.......#.........#...#...#.#...#...###.#...#...#...#...#...#.#.#.#.#.#.#.#.#.....#.....#.#.....#.#...#...#.........#
###.#.#.#.###.#.#.#.#.#####################.#.###.#.#####.#.###.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#.#####.#####.#######.#.###.#.#.#########
#...#...#.....#...#...###.................#.#.....#.......#...#.#.#...###.#.#.#.#...#...#...#.#.#.#.#...#...#...#...#...#...#...#.#.........#
#.#######################.###############.#.#################.#.#.#######.#.#.#.#.###########.#.#.#.###.#.###.#.###.#.#.#####.###.#########.#
#...#...............#...#...............#...#.....#...#.......#...#...###.#.#.#.#...........#.#.#...###.#.#...#.....#.#.#...#...#.#.........#
###.#.#############.#.#.###############.#####.###.#.#.#.###########.#.###.#.#.#.###########.#.#.#######.#.#.#########.#.#.#.###.#.#.#########
###...#####...#...#.#.#.#...#.....#...#.....#...#...#.#.#...#.......#.#...#.#.#.#...........#.#...#...#...#...........#.#.#...#.#.#.#.......#
###########.#.#.#.#.#.#.#.#.#.###.#.#.#####.###.#####.#.#.#.#.#######.#.###.#.#.#.###########.###.#.#.#################.#.###.#.#.#.#.#####.#
#...###.....#...#...#.#.#.#.#.#...#.#.#.....#...#.....#...#.#...#.....#.#...#.#.#.#.........#.#...#.#.#...#.......#.....#.#...#.#.#...#...#.#
#.#.###.#############.#.#.#.#.#.###.#.#v#####.###.#########.###.#.#####.#.###.#.#v#.#######.#.#.###.#.#.#.#.#####.#.#####.#.###.#.#####v#.#.#
#.#.....#...#...###...#.#.#.#.#.#...#.>.>...#...#...#...#...#...#...#...#...#.#.>.>.#.......#...#...#...#.#...###...###...#.#...#...#.>.#.#.#
#.#######.#.#.#.###.###.#.#.#.#.#.#########.###.###.#.#.#.###.#####.#.#####.#.#######.###########.#######.###.#########.###.#.#####.#.#v#.#.#
#.#.......#...#.#...###.#.#.#.#.#.......###...#.#...#.#.#...#.#.....#.....#.#.###...#.....#...###.......#...#.#...###...###.#.#.....#.#.#...#
#.#.###########.#.#####.#.#.#.#.#######.#####.#.#.###.#.###v#.#.#########.#.#.###.#.#####.#.#.#########.###.#.#.#.###.#####.#.#.#####.#.#####
#.#.#...........#.....#.#.#.#.#...#...#...###.#.#...#.#.#.>.>.#...#...#...#.#.#...#.......#.#.#...###...#...#.#.#.#...#####.#.#.......#.....#
#.#.#.###############.#.#.#.#.###.#.#.###.###.#.###.#.#.#.#######.#.#.#.###.#.#.###########.#.#.#.###.###.###.#.#.#.#######.#.#############.#
#...#...........#.....#...#...#...#.#...#.#...#.#...#.#.#.......#...#.#...#.#.#.#.......#...#.#.#.#...#...#...#.#.#.......#.#.#.............#
###############.#.#############.###.###.#.#.###.#.###.#.#######.#####.###.#.#.#.#.#####.#.###.#.#.#.###.###.###.#.#######.#.#.#.#############
#...............#.............#...#...#.#.#...#.#...#.#...#...#.#.....#...#...#.#.#.....#...#.#.#.#...#.###...#.#.#.......#...#...#...#...###
#.###########################.###.###.#.#.###.#.###.#.###.#.#.#.#.#####.#######.#.#.#######.#.#.#.###.#.#####v#.#.#.#############.#.#.#.#.###
#.#...#...#.....#...#...#...#.#...#...#.#.#...#...#.#...#.#.#.#.#.....#.....#...#.#.#.....#.#.#.#...#.#...#.>.>.#.#.........#.....#.#.#.#...#
#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.###.###.#.#.#####.#.###.#.#.#.#.#####.#####.#.###.#.#.###.#.#.#.###.#.###.#.#####.#########.#.#####.#.#.###.#
#...#...#...###...#...#...#...#.....###...#.......#.....#...#...#####.......#.....#...###...#...###...###...#####...........#.......#...###.#
###########################################################################################################################################.#"""

test_input="""#.#####################
#.......#########...###
#######.#########.#.###
###.....#.>.>.###.#.###
###v#####.#v#.###.#.###
###.>...#.#.#.....#...#
###v###.#.#.#########.#
###...#.#.#.......#...#
#####.#.#.#######.#.###
#.....#.#.#.......#...#
#.#####.#.#.#########v#
#.#...#...#...###...>.#
#.#.#v#######v###.###v#
#...#.>.#...>.>.#.###.#
#####v#.#.###v#.#.###.#
#.....#...#...#.#.#...#
#.#########.###.#.#.###
#...###...#...#...#.###
###.###.#.###v#####v###
#...#...#.#.>.>.#.>.###
#.###.###.#.###.#.#v###
#.....###...###...#...#
#####################.#"""

import cProfile
import copy
import heapq

# type aliasing - need a pretty new python for this :)
type Location = tuple[int,int]

class Node:
    location: Location
    came_from: Location

    def __init__(self, _location:Location, _came_from:Location):
        self.location = _location
        self.came_from = _came_from

    def __eq__(self, other):
        isNode = isinstance(other, self.__class__)
        if not isNode:
            return False
        if self.location != other.location:
            return False
        if self.came_from != other.came_from:
            return False
        return True
    
    # want heapq to give us what first??
    def __lt__(self, other):
        if self.location == other.location:
            return self.came_from<other.came_from
        return self.location<other.location
      
    def __hash__(self):
        return hash(self.location)+hash(self.came_from)

def parse_input(_input: str) -> (dict[Location,str], list[Location], tuple[int,int]):
    lines = _input.split("\n")
    map_squares = {}
    entrances = []
    for y,line in enumerate(lines):
        for x,char in enumerate(line):
            map_squares[(x,y)]=char
            is_on_side = (x==0 or x==len(line)-1) or (y==0 or y==len(lines)-1)
            if char == '.' and  is_on_side:
                entrances.append((x,y))
    extents = (len(lines[0]),len(lines))
    return map_squares,entrances,extents

def debug_print(path: list[Location], map_squares: dict[Location,str], extents: tuple[int,int]):
    # debug print the picture:
    for y in range(0, extents[1]):
        for x in range(0, extents[0]):
            on_path=' '
            for pn in path:
                if pn.location == (x,y):
                    on_path = 'O'

            print(f"{map_squares[(x,y)]}{on_path} ", end="")
        print("") # newline
    print("") # newline

def is_neighbour_accessible(possible_neighbour:Location, map_squares: dict[Location,str]):
    if possible_neighbour not in map_squares: # check we didn;t fall off the edge
        return False
    if map_squares[possible_neighbour] == "#":
        return False
    return True



def get_possible_neighbours(current:Location, visited: list[Location], map_squares: dict[Location,str]):
  
    neighbours: list[Location] = []

    # if we're on a slope we follow the slope
    if map_squares[current] == "<":
        possible_neighbour=(current[0]-1,current[1])
        if possible_neighbour not in visited:
            neighbours.append(possible_neighbour)
        return neighbours
    if map_squares[current] == ">":
        possible_neighbour=(current[0]+1,current[1])
        if possible_neighbour not in visited:
            neighbours.append(possible_neighbour)
        return neighbours
    if map_squares[current] == "v":
        possible_neighbour=(current[0],current[1]+1)
        if possible_neighbour not in visited:
            neighbours.append(possible_neighbour)
        return neighbours
    if map_squares[current] == "^":
        possible_neighbour=(current[0],current[1]-1)
        if possible_neighbour not in visited:
            neighbours.append(possible_neighbour)
        return neighbours

    # let's look in the 4 directions around us
    possible_neighbour=(current[0]-1,current[1])
    if is_neighbour_accessible(possible_neighbour, map_squares) and possible_neighbour not in visited :
        neighbours.append(possible_neighbour)
    possible_neighbour=(current[0]+1,current[1])
    if is_neighbour_accessible(possible_neighbour, map_squares) and possible_neighbour not in visited:
        neighbours.append(possible_neighbour)
    possible_neighbour=(current[0],current[1]-1)
    if is_neighbour_accessible(possible_neighbour, map_squares) and possible_neighbour not in visited:
        neighbours.append(possible_neighbour)
    possible_neighbour=(current[0],current[1]+1)
    if is_neighbour_accessible(possible_neighbour, map_squares) and possible_neighbour not in visited:
        neighbours.append(possible_neighbour)

    return neighbours

def reconstruct_path(current: Node) -> list[Node]:
    total_path = [current]
    while current.came_from is not None:
        current = current.came_from
        total_path.insert(0,current)
    return total_path


def follow_path(start:Location, goal:Location, map_squares: dict[Location,str]) -> int:

    possible_paths = []
    max_path_len = 0

    open_nodes = []
    open_nodes.append(Node(start,None))
    while(len(open_nodes)):
        current = open_nodes.pop()

        if current.location == goal:
            path = reconstruct_path(current)
            print(len(path)-1)
            possible_paths.append(copy.deepcopy(path))
            max_path_len = max(max_path_len,len(path)-1)
            continue 

        path = reconstruct_path(current)
        visited = []
        for node in path:
            visited.append(node.location)
        neighbours = get_possible_neighbours(current.location, visited, map_squares)
        if len(neighbours) == 0:
            # dead end
            # back to the last decision
            continue
        
        for neighbour in neighbours:
            open_nodes.append( Node(neighbour,current))
    
    return max_path_len
   

def run(_input):
    map_squares,entrances,extents=parse_input(_input)
    start = entrances[0]
    goal = entrances[1]
    longest = follow_path(start,goal,map_squares)
    print(longest)

run(actual_input)